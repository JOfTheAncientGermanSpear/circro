
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Circro_Oct_27</title><meta name="generator" content="MATLAB 8.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2013-10-28"><meta name="DC.source" content="Circro_Oct_27.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><pre class="codeinput"><span class="keyword">function</span> varargout = Circro_Oct_27(varargin)
<span class="comment">% surface rendering for NIfTI images, can be run from user interface or scripted</span>
<span class="comment">%Examples:</span>
<span class="comment">% MATcro %launch MATcro</span>
<span class="comment">% MATcro('openLayer',{'avg152T1_brain.nii.gz'}); %open image</span>
<span class="comment">% MATcro('simplifyLayers', 0.5); %reduce mesh to 50% complexity</span>
<span class="comment">% MATcro('closeLayers'); %close all images</span>
<span class="comment">% MATcro('openLayer',{'cortex_20484.surf.gii'}); %open image</span>
<span class="comment">% MATcro('openLayer',{'attention.nii.gz'}, 3.0); %add fMRI overlay, threshold t&gt;3</span>
<span class="comment">% MATcro('openLayer',{'saccades.nii.gz'}, 3.0); %add fMRI overlay threshold t&gt;3</span>
<span class="comment">% MATcro('openLayer',{'scalp_2562.surf.gii'}); %add scalp overlay</span>
<span class="comment">% MATcro('layerRGBA', 4, 0.9, 0.5, 0.5, 0.2); %make scalp reddish</span>
<span class="comment">% MATcro('setMaterial', 0.1, 0.4, 0.9, 50, 0, 1); %make surfaces shiny</span>
<span class="comment">% for i=-27:9</span>
<span class="comment">% 	MATcro('setView', i*10, 35); %rotate azimuth, constant elevation</span>
<span class="comment">% 	pause(0.1);</span>
<span class="comment">% end;</span>
<span class="comment">% MATcro('copyBitmap'); %copy screenshot to clipboard</span>
<span class="comment">% MATcro('saveBitmap',{'myPicture.png'}); %save screenshot</span>
<span class="comment">% MATcro('saveMesh',{'myMesh.ply'}); %export mesh to PLY format</span>
mOutputArgs = {}; <span class="comment">% Variable for storing output when GUI returns</span>
h = findall(0,<span class="string">'tag'</span>,mfilename); <span class="comment">%run as singleton</span>
<span class="keyword">if</span> (isempty(h)) <span class="comment">% new instance</span>
   h = makeGUI(); <span class="comment">%set up user interface</span>
<span class="keyword">else</span> <span class="comment">% instance already running</span>
   figure(h);  <span class="comment">%Figure exists so bring Figure to the focus</span>
<span class="keyword">end</span>
<span class="keyword">if</span> (nargin) &amp;&amp; (ischar(varargin{1}))
 f = str2func(varargin{1});
 f(guidata(h),varargin{2:nargin})
<span class="keyword">end</span>
mOutputArgs{1} = h;<span class="comment">% return handle to main figure</span>
<span class="keyword">if</span> nargout&gt;0
 [varargout{1:nargout}] = mOutputArgs{:};
<span class="keyword">end</span>
<span class="comment">%end Circro</span>

<span class="comment">% --- Declare and create all the user interface objects</span>
<span class="keyword">function</span> [vFig] = makeGUI()
sz = [980 680]; <span class="comment">% figure width, height in pixels</span>
screensize = get(0,<span class="string">'ScreenSize'</span>);
margin = [ceil((screensize(3)-sz(1))/2) ceil((screensize(4)-sz(2))/2)];
v.hMainFigure = figure(<span class="string">'MenuBar'</span>,<span class="string">'none'</span>,<span class="string">'Toolbar'</span>,<span class="string">'none'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'on'</span>, <span class="keyword">...</span>
  <span class="string">'position'</span>,[margin(1), margin(2), sz(1), sz(2)], <span class="keyword">...</span>
    <span class="string">'Tag'</span>, mfilename,<span class="string">'Name'</span>, mfilename, <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
 <span class="string">'Color'</span>, [1 1 1]);
set(v.hMainFigure,<span class="string">'Renderer'</span>,<span class="string">'OpenGL'</span>)
v.hAxes = axes(<span class="string">'Parent'</span>, v.hMainFigure,<span class="string">'HandleVisibility'</span>,<span class="string">'on'</span>,<span class="string">'Units'</span>, <span class="string">'normalized'</span>,<span class="string">'Position'</span>,[0.0 0.0 1 1]); <span class="comment">%important: turn ON visibility</span>
<span class="comment">%menus...</span>
v.hFileMenu = uimenu(<span class="string">'Parent'</span>,v.hMainFigure,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Label'</span>,<span class="string">'File'</span>);
v.hAddMenu = uimenu(<span class="string">'Parent'</span>,v.hFileMenu,<span class="string">'Label'</span>,<span class="string">'Select list of nodes'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>, <span class="string">'Callback'</span>, @Add_nodes_Callback); <span class="comment">% to open the list of nodes</span>

v.hEditMenu = uimenu(<span class="string">'Parent'</span>,v.hMainFigure,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Label'</span>,<span class="string">'Edit'</span>);
v.hCopyMenu = uimenu(<span class="string">'Parent'</span>,v.hEditMenu,<span class="string">'Label'</span>,<span class="string">'Copy'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Callback'</span>, @CopyMenu_Callback);
v.hFunctionMenu = uimenu(<span class="string">'Parent'</span>,v.hMainFigure,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Label'</span>,<span class="string">'Functions'</span>);
v.hToolbarMenu = uimenu(<span class="string">'Parent'</span>,v.hFunctionMenu,<span class="string">'Label'</span>,<span class="string">'Show/hide toolbar'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Callback'</span>, @ToolbarMenu_Callback);
v.hToolbarMenu = uimenu(<span class="string">'Parent'</span>,v.hFunctionMenu,<span class="string">'Label'</span>,<span class="string">'Select values'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Callback'</span>, @Add_sizes_Callback);
v.hToolbarMenu = uimenu(<span class="string">'Parent'</span>,v.hFunctionMenu,<span class="string">'Label'</span>,<span class="string">'Select colors'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Callback'</span>, @Add_colors_Callback);
v.hToolbarMenu = uimenu(<span class="string">'Parent'</span>,v.hFunctionMenu,<span class="string">'Label'</span>,<span class="string">'Select matrix'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Callback'</span>, @Add_colors_Callback);
v.hSaveBmpMenu = uimenu(<span class="string">'Parent'</span>,v.hFileMenu,<span class="string">'Label'</span>,<span class="string">'Save bitmap'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>, <span class="string">'Callback'</span>, @SaveBmpMenu_Callback);

v.hHelpMenu = uimenu(<span class="string">'Parent'</span>,v.hMainFigure,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Label'</span>,<span class="string">'Help'</span>);
v.hAboutMenu = uimenu(<span class="string">'Parent'</span>,v.hHelpMenu,<span class="string">'Label'</span>,<span class="string">'About'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'callback'</span>,<span class="string">'Callback'</span>, @AboutMenu_Callback);

<span class="comment">%viewing preferences - color, material, camera position, light position</span>
v.vprefs.demoObjects = true; <span class="comment">%denote simulated objects</span>
v.vprefs.colors = [0.7 0.7 0.9 0.6; 1 0 0 0.7; 0 1 0 0.7; 0 0 1 0.7; 0.5 0.5 0 0.7; 0.5 0 0.5 0.7; 0 0.5 0.5 0.7]; <span class="comment">%rgba for each layer</span>
v.vprefs.materialKaKdKsn = [0.6 0.4 0.4, 100.0];<span class="comment">%ambient/diffuse/specular strength and specular exponent</span>
v.vprefs.bgMode = 0; <span class="comment">%background mode: wireframe, faces, faces+edges</span>
v.vprefs.backFaceLighting = 1;
v.vprefs.azLight = 0; <span class="comment">%light azimuth relative to camera</span>
v.vprefs.elLight = 60; <span class="comment">%light elevation relative to camera</span>
v.vprefs.camLight = [];
v.vprefs.az = 45; <span class="comment">%camera azimuth</span>
v.vprefs.el = 10; <span class="comment">%camera elevation</span>
v.vprefs.color = [1 1 1]  ; <span class="comment">%camera elevation</span>
guidata(v.hMainFigure,v);<span class="comment">%store settings</span>
vFig = v.hMainFigure;
<span class="comment">%end makeGUI()</span>

<span class="comment">% Callback functions</span>

<span class="comment">% --- add a circle with default options</span>
<span class="keyword">function</span> Add_nodes_Callback(obj, eventdat)
v=guidata(obj);
SelectFileToOpen(v);
v=guidata(obj);
list_regions=v.list_regions;
v.number_region=numel(list_regions);
draw_circle(list_regions,v); <span class="comment">% write circle with the regions listed</span>
fprintf(<span class="string">'Drawing circle with %d regions\n'</span>,numel(list_regions))
write_names(list_regions,1.2,pi/2);
<span class="comment">%end Add_nodes_Callback()</span>

<span class="comment">% --- show/hide figure toolbar</span>
<span class="keyword">function</span> ToolbarMenu_Callback(obj, eventdata)
<span class="keyword">if</span> strcmpi(get(gcf, <span class="string">'Toolbar'</span>),<span class="string">'none'</span>)
    set(gcf,  <span class="string">'Toolbar'</span>, <span class="string">'figure'</span>);
<span class="keyword">else</span>
    set(gcf,  <span class="string">'Toolbar'</span>, <span class="string">'none'</span>);
<span class="keyword">end</span>
<span class="comment">%end ToolbarMenu_Callback()</span>

<span class="comment">% --- save screenshot as bitmap image</span>
<span class="keyword">function</span> SaveBmpMenu_Callback(obj, eventdata)
v=guidata(obj);
[file,path] = uiputfile(<span class="string">'*.png'</span>,<span class="string">'Save image as'</span>);
<span class="keyword">if</span> isequal(file,0), <span class="keyword">return</span>; <span class="keyword">end</span>;
saveBitmap(v,[path file]);
<span class="comment">%end SaveBmpMenu_Callback()</span>

<span class="comment">% --- add a circle with default options</span>
<span class="keyword">function</span> Add_sizes_Callback(obj, eventdat)
v=guidata(obj);
Select_size_data(v);
v=guidata(obj);
value_sizes=v.value_sizes;
num_value_size=numel(value_sizes);
list_value_sizes(1:num_value_size/2,2)=flipud(((num_value_size/2)+1:num_value_size)'); <span class="comment">% here in case I decide to add display values in the future</span>
<span class="keyword">if</span> isfield(v,<span class="string">'list_regions'</span>)
    list_regions=v.list_regions; <span class="comment">% nodes were previously selected</span>
<span class="keyword">else</span>
    temp=[(1:num_value_size/2)' flipud((((num_value_size/2)+1):num_value_size)')]; <span class="comment">% nodes were not previously selected- assigning names</span>
    list_regions=(num2cell(temp));
<span class="keyword">end</span>
value_sizes=v.value_sizes;
draw_circle(list_regions,v,value_sizes);
fprintf(<span class="string">'Drawing circle with %d regions\n'</span>,numel(list_regions))
<span class="keyword">if</span> exist(<span class="string">'list_regions'</span>,<span class="string">'var'</span>)
    write_names(list_regions,(1+max(value_sizes(:))),pi/2);
<span class="keyword">end</span>
<span class="comment">%end Add_sizes_Callback()</span>

<span class="keyword">function</span> Add_colors_Callback(obj, eventdat)
v=guidata(obj);
Select_colors_data(v);
v=guidata(obj);
value_colors=v.value_colors;
num_value_colors=numel(value_colors);
size_value_colors=size(value_colors);
list_value_colors(1:num_value_colors/2,2)=flipud(((num_value_colors/2)+1:num_value_colors)'); <span class="comment">% here in case I decide to add display values in the future</span>
<span class="keyword">if</span> isfield(v,<span class="string">'list_regions'</span>)
    list_regions=v.list_regions; <span class="comment">% nodes were previously selected</span>
<span class="keyword">else</span>
    temp=[(1:num_value_colors/2)' flipud((((num_value_colors/2)+1):num_value_colors)')]; <span class="comment">% nodes were not previously selected- assigning names</span>
    list_regions=(num2cell(temp));
<span class="keyword">end</span>
value_colors=v.value_colors;
fprintf(<span class="string">'Drawing circle with %d regions\n'</span>,numel(value_colors))
<span class="keyword">if</span> isfield(v,<span class="string">'value_sizes'</span>)
    value_sizes=v.value_sizes;
    draw_circle(list_regions,v,value_sizes); <span class="comment">%sizes were previously selected</span>
<span class="keyword">else</span>
    draw_circle(list_regions,v,(ones(size_value_colors))/4,value_colors)
<span class="keyword">end</span>
<span class="keyword">if</span> exist(<span class="string">'list_regions'</span>,<span class="string">'var'</span>)
    write_names(list_regions,(1+max(value_colors(:))),pi/2);
<span class="keyword">end</span>
<span class="comment">% draw_circle(list_regions,v,value_sizes);</span>

<span class="comment">% --- open a mesh or voxel image</span>
<span class="keyword">function</span> SelectFileToOpen(v)
<span class="comment">%filename: mesh (GIFTI,VTK,PLY) or NIFTI voxel image to open</span>
<span class="comment">% thresh : (NIFTI only) isosurface threshold Inf for automatic, -Inf for dialog input</span>
<span class="comment">% reduce : (NIFTI only) path reduction ratio, e.g. 0.2 makes mesh 20% original size</span>
<span class="comment">% smooth : (NIFTI only) radius of smoothing, 0 = no smoothing</span>

    [list_filename, list_pathname] = uigetfile( <span class="keyword">...</span>
                    {<span class="string">'*.xlsx;'</span>, <span class="string">'excel files (*.xlsx)'</span>;<span class="keyword">...</span>
                    <span class="string">'*.xls;'</span>, <span class="string">'excel files (*.xls)'</span>; <span class="keyword">...</span>
                    <span class="string">'*.*'</span>,       <span class="string">'All Files (*.*)'</span>},<span class="keyword">...</span>
                    <span class="string">'Select a text file'</span>);
    <span class="keyword">if</span> isequal(list_filename,0), <span class="keyword">return</span>; <span class="keyword">end</span>;

    [~, list_regions]=xlsread([list_pathname list_filename]);
    v.list_regions=list_regions;
    guidata(v.hMainFigure,v)

<span class="comment">% --- creates renderings</span>
<span class="keyword">function</span> draw_circle(list_regions,v,sizes,colors,colorscheme)
axis <span class="string">square</span>
delete(allchild(v.hAxes));<span class="comment">%</span>
set(v.hMainFigure,<span class="string">'CurrentAxes'</span>,v.hAxes)
set(0, <span class="string">'CurrentFigure'</span>, v.hMainFigure);  <span class="comment">%# for figures</span>
    n=(size(list_regions,1)*(size(list_regions,2)));
    <span class="keyword">if</span> nargin&lt;3;
        <span class="comment">% set constants</span>
        r = 1;  <span class="comment">% sets the outer radius</span>
        list_sizes(1:n,1)=r*1.1; <span class="comment">% sets the inner radius as 0.9 of R</span>
    <span class="keyword">else</span>
        r = 1;
        list_sizes(1:n/2,1)=sizes(1:end,1);
        list_sizes(1:n/2,2)=flipud(sizes(1:end,2));<span class="comment">% flip the second column for sequential drawing of segments</span>
        list_sizes=list_sizes+r;
    <span class="keyword">end</span>
    <span class="keyword">if</span> nargin&gt;=4
        list_colors(1:n/2,1)=colors(1:end,1);
        list_colors(1:n/2,2)=flipud(colors(1:end,2));
        list_colors=[list_colors(1:n/2,1);list_colors(1:n/2,2)]; <span class="comment">% organized into one single column</span>

    <span class="keyword">else</span>
        list_colors=rand(n,1);
        list_colors(n/2,1)=0.5;<span class="comment">% set the mid value as on (to set the color as the mid-value</span>
    <span class="keyword">end</span>
    <span class="keyword">if</span> nargin&lt;5
        colorscheme=hot;
    <span class="keyword">end</span>
    start_radian=pi/2; <span class="comment">%sets the origin of the first segment (could also be 0)</span>
    end_radian=start_radian+(2*pi)/n; <span class="comment">%sets the end of the first segment (could also be pi/2)</span>
    <span class="comment">% end constants</span>

    axis <span class="string">square</span>
    <span class="keyword">for</span> segment=1:n <span class="comment">% draw the circle</span>
        <span class="comment">% map colors</span>
        color=find_color_in_colorscheme(list_colors(segment),list_colors,colorscheme);
        draw_segment(start_radian,end_radian,list_sizes(segment),r,color,[])
        start_radian=end_radian;
        end_radian=start_radian+(2*pi)/n;
        pause(0.01)
        hold <span class="string">on</span>
    <span class="keyword">end</span>
    R=max(list_sizes(:));
    axis([-2.3*R 2.3*R -2.3*R 2.3*R])
    axis <span class="string">square</span>
    axis <span class="string">off</span>

<span class="keyword">function</span> draw_segment(start,term,R,r,color,height)

    seg = linspace( start, term, 100);
    <span class="comment">%outer rim</span>
    <span class="keyword">if</span> isempty(height)
        height=0;
    <span class="keyword">end</span>
    x_1 = (R+height)*cos(seg) ;
    y_1 = (R+height)*sin(seg) ;
    <span class="comment">%inner rim</span>
    x_2 = r*cos(seg) ;
    y_2 = r*sin(seg) ;
    <span class="comment">% flip inner rim</span>
    x_2=flipdim(x_2,2);
    y_2=flipdim(y_2,2);
    X=[x_1 x_2];
    Y=[y_1 y_2];
    pol=fill(X,Y,<span class="string">'r'</span>);
    <span class="keyword">if</span> ~isempty(color)
        set(pol,<span class="string">'FaceColor'</span>,color)
    <span class="keyword">end</span>
    set(pol,<span class="string">'EdgeColor'</span>,<span class="string">'k'</span>)
    set(pol,<span class="string">'FaceAlpha'</span>,0.4)

<span class="comment">%end draw segment</span>

<span class="keyword">function</span> write_names(list_regions,radius,start_radian)
    regions=[list_regions(:,1);flipud(list_regions(:,2))]; <span class="comment">% flip right hemisphere regions</span>
    number_regions=size(regions,1);
    <span class="keyword">for</span> i=1:number_regions
        theta=  ( (start_radian + ( (i-1) *(2*pi/number_regions) ))<span class="keyword">...</span>
            + (start_radian + ( (i *(2*pi/number_regions) )) ))/2 ;
        x = radius * cos(theta);
        y = radius * sin(theta);
        <span class="keyword">if</span> ischar(regions{i})
            name=regions{i};
        <span class="keyword">else</span>
            name=num2str(regions{i});
        <span class="keyword">end</span>
        text(x*(1.1), y*(1.1), name, <span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="string">'FontSize'</span>,10)
    <span class="keyword">end</span>

<span class="comment">% end write names</span>
<span class="keyword">function</span> Select_size_data(v)
[sizes_filename, sizes_pathname] = uigetfile( <span class="keyword">...</span>
                    {<span class="string">'*.xlsx;'</span>, <span class="string">'excel files (*.xlsx)'</span>;<span class="keyword">...</span>
                    <span class="string">'*.xls;'</span>, <span class="string">'excel files (*.xls)'</span>; <span class="keyword">...</span>
                    <span class="string">'*.*'</span>,       <span class="string">'All Files (*.*)'</span>},<span class="keyword">...</span>
                    <span class="string">'Select a text file'</span>);
    <span class="keyword">if</span> isequal(sizes_filename,0), <span class="keyword">return</span>; <span class="keyword">end</span>;
    [value_sizes, ~]=xlsread([sizes_pathname sizes_filename]);
    v.value_sizes=value_sizes;
    guidata(v.hMainFigure,v)
<span class="comment">% end Select_size_data</span>

<span class="keyword">function</span> Select_colors_data(v)
[colors_filename, colors_pathname] = uigetfile( <span class="keyword">...</span>
                    {<span class="string">'*.xlsx;'</span>, <span class="string">'excel files (*.xlsx)'</span>;<span class="keyword">...</span>
                    <span class="string">'*.xls;'</span>, <span class="string">'excel files (*.xls)'</span>; <span class="keyword">...</span>
                    <span class="string">'*.*'</span>,       <span class="string">'All Files (*.*)'</span>},<span class="keyword">...</span>
                    <span class="string">'Select a text file'</span>);
    <span class="keyword">if</span> isequal(colors_filename,0), <span class="keyword">return</span>; <span class="keyword">end</span>;
    [value_colors, ~]=xlsread([colors_pathname colors_filename]);
    v.value_colors=value_colors;
    guidata(v.hMainFigure,v)

<span class="comment">% --- Save screenshot as bitmap image</span>
<span class="keyword">function</span> saveBitmap(v,varargin)
<span class="comment">% inputs: filename</span>
<span class="comment">%MATcro('saveBitmap',{'myPicture.png'});</span>
<span class="keyword">if</span> (length(varargin) &lt; 1), <span class="keyword">return</span>; <span class="keyword">end</span>;
filename = char(varargin{1});
<span class="comment">%saveas(v.hAxes, filename,'png'); %&lt;- save as 150dpi</span>
print (v.hMainFigure, <span class="string">'-r600'</span>, <span class="string">'-dpng'</span>, filename); <span class="comment">%&lt;- save as 600dpi , '-noui'</span>
<span class="comment">%end saveBitmap()</span>

<span class="comment">% find value associated with a color</span>
<span class="keyword">function</span> color=find_color_in_colorscheme(value,range,colorscheme)
    cm_length=size(colorscheme,1); <span class="comment">% length of the colormap</span>
    cmin=min(range); <span class="comment">% min</span>
    cmax=max(range); <span class="comment">% max</span>
    csteps=linspace(cmin,cmax,cm_length); <span class="comment">% incremental steps from min to max within the length of the colormap</span>
    C_index = ( abs(value-csteps) == min(abs(value-csteps)) ); <span class="comment">% find the closest step to value</span>
    color=colorscheme(C_index,:); <span class="comment">% color associated with value</span>
<span class="comment">%end find_color_in_colorscheme</span>
</pre><img vspace="5" hspace="5" src="Circro_Oct_27_01.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2013b</a><br></p></div><!--
##### SOURCE BEGIN #####
function varargout = Circro_Oct_27(varargin)
% surface rendering for NIfTI images, can be run from user interface or scripted
%Examples:
% MATcro %launch MATcro
% MATcro('openLayer',{'avg152T1_brain.nii.gz'}); %open image
% MATcro('simplifyLayers', 0.5); %reduce mesh to 50% complexity
% MATcro('closeLayers'); %close all images
% MATcro('openLayer',{'cortex_20484.surf.gii'}); %open image
% MATcro('openLayer',{'attention.nii.gz'}, 3.0); %add fMRI overlay, threshold t>3
% MATcro('openLayer',{'saccades.nii.gz'}, 3.0); %add fMRI overlay threshold t>3
% MATcro('openLayer',{'scalp_2562.surf.gii'}); %add scalp overlay
% MATcro('layerRGBA', 4, 0.9, 0.5, 0.5, 0.2); %make scalp reddish
% MATcro('setMaterial', 0.1, 0.4, 0.9, 50, 0, 1); %make surfaces shiny
% for i=-27:9
% 	MATcro('setView', i*10, 35); %rotate azimuth, constant elevation
% 	pause(0.1);
% end;
% MATcro('copyBitmap'); %copy screenshot to clipboard
% MATcro('saveBitmap',{'myPicture.png'}); %save screenshot
% MATcro('saveMesh',{'myMesh.ply'}); %export mesh to PLY format
mOutputArgs = {}; % Variable for storing output when GUI returns
h = findall(0,'tag',mfilename); %run as singleton
if (isempty(h)) % new instance
   h = makeGUI(); %set up user interface
else % instance already running
   figure(h);  %Figure exists so bring Figure to the focus
end
if (nargin) && (ischar(varargin{1})) 
 f = str2func(varargin{1});
 f(guidata(h),varargin{2:nargin})
end
mOutputArgs{1} = h;% return handle to main figure
if nargout>0
 [varargout{1:nargout}] = mOutputArgs{:};
end
%end Circro

% REPLACE_WITH_DASH_DASH- Declare and create all the user interface objects
function [vFig] = makeGUI()
sz = [980 680]; % figure width, height in pixels
screensize = get(0,'ScreenSize');
margin = [ceil((screensize(3)-sz(1))/2) ceil((screensize(4)-sz(2))/2)];
v.hMainFigure = figure('MenuBar','none','Toolbar','none','HandleVisibility','on', ...
  'position',[margin(1), margin(2), sz(1), sz(2)], ... 
    'Tag', mfilename,'Name', mfilename, 'NumberTitle','off', ...
 'Color', [1 1 1]);
set(v.hMainFigure,'Renderer','OpenGL')
v.hAxes = axes('Parent', v.hMainFigure,'HandleVisibility','on','Units', 'normalized','Position',[0.0 0.0 1 1]); %important: turn ON visibility
%menus...
v.hFileMenu = uimenu('Parent',v.hMainFigure,'HandleVisibility','callback','Label','File');
v.hAddMenu = uimenu('Parent',v.hFileMenu,'Label','Select list of nodes','HandleVisibility','callback', 'Callback', @Add_nodes_Callback); % to open the list of nodes

v.hEditMenu = uimenu('Parent',v.hMainFigure,'HandleVisibility','callback','Label','Edit');
v.hCopyMenu = uimenu('Parent',v.hEditMenu,'Label','Copy','HandleVisibility','callback','Callback', @CopyMenu_Callback);
v.hFunctionMenu = uimenu('Parent',v.hMainFigure,'HandleVisibility','callback','Label','Functions');
v.hToolbarMenu = uimenu('Parent',v.hFunctionMenu,'Label','Show/hide toolbar','HandleVisibility','callback','Callback', @ToolbarMenu_Callback);
v.hToolbarMenu = uimenu('Parent',v.hFunctionMenu,'Label','Select values','HandleVisibility','callback','Callback', @Add_sizes_Callback);
v.hToolbarMenu = uimenu('Parent',v.hFunctionMenu,'Label','Select colors','HandleVisibility','callback','Callback', @Add_colors_Callback);
v.hToolbarMenu = uimenu('Parent',v.hFunctionMenu,'Label','Select matrix','HandleVisibility','callback','Callback', @Add_colors_Callback);
v.hSaveBmpMenu = uimenu('Parent',v.hFileMenu,'Label','Save bitmap','HandleVisibility','callback', 'Callback', @SaveBmpMenu_Callback);

v.hHelpMenu = uimenu('Parent',v.hMainFigure,'HandleVisibility','callback','Label','Help');
v.hAboutMenu = uimenu('Parent',v.hHelpMenu,'Label','About','HandleVisibility','callback','Callback', @AboutMenu_Callback);

%viewing preferences - color, material, camera position, light position
v.vprefs.demoObjects = true; %denote simulated objects
v.vprefs.colors = [0.7 0.7 0.9 0.6; 1 0 0 0.7; 0 1 0 0.7; 0 0 1 0.7; 0.5 0.5 0 0.7; 0.5 0 0.5 0.7; 0 0.5 0.5 0.7]; %rgba for each layer
v.vprefs.materialKaKdKsn = [0.6 0.4 0.4, 100.0];%ambient/diffuse/specular strength and specular exponent
v.vprefs.bgMode = 0; %background mode: wireframe, faces, faces+edges
v.vprefs.backFaceLighting = 1;
v.vprefs.azLight = 0; %light azimuth relative to camera
v.vprefs.elLight = 60; %light elevation relative to camera
v.vprefs.camLight = [];
v.vprefs.az = 45; %camera azimuth
v.vprefs.el = 10; %camera elevation
v.vprefs.color = [1 1 1]  ; %camera elevation
guidata(v.hMainFigure,v);%store settings
vFig = v.hMainFigure;
%end makeGUI()

% Callback functions

% REPLACE_WITH_DASH_DASH- add a circle with default options
function Add_nodes_Callback(obj, eventdat)
v=guidata(obj);
SelectFileToOpen(v);
v=guidata(obj);
list_regions=v.list_regions;
v.number_region=numel(list_regions); 
draw_circle(list_regions,v); % write circle with the regions listed
fprintf('Drawing circle with %d regions\n',numel(list_regions))
write_names(list_regions,1.2,pi/2);
%end Add_nodes_Callback()

% REPLACE_WITH_DASH_DASH- show/hide figure toolbar
function ToolbarMenu_Callback(obj, eventdata)
if strcmpi(get(gcf, 'Toolbar'),'none')
    set(gcf,  'Toolbar', 'figure');
else
    set(gcf,  'Toolbar', 'none');
end
%end ToolbarMenu_Callback()

% REPLACE_WITH_DASH_DASH- save screenshot as bitmap image
function SaveBmpMenu_Callback(obj, eventdata)
v=guidata(obj);
[file,path] = uiputfile('*.png','Save image as');
if isequal(file,0), return; end;
saveBitmap(v,[path file]);
%end SaveBmpMenu_Callback()

% REPLACE_WITH_DASH_DASH- add a circle with default options
function Add_sizes_Callback(obj, eventdat)
v=guidata(obj);
Select_size_data(v);
v=guidata(obj);
value_sizes=v.value_sizes;
num_value_size=numel(value_sizes);
list_value_sizes(1:num_value_size/2,2)=flipud(((num_value_size/2)+1:num_value_size)'); % here in case I decide to add display values in the future
if isfield(v,'list_regions')
    list_regions=v.list_regions; % nodes were previously selected
else
    temp=[(1:num_value_size/2)' flipud((((num_value_size/2)+1):num_value_size)')]; % nodes were not previously selected- assigning names
    list_regions=(num2cell(temp));
end
value_sizes=v.value_sizes;
draw_circle(list_regions,v,value_sizes);
fprintf('Drawing circle with %d regions\n',numel(list_regions))
if exist('list_regions','var')
    write_names(list_regions,(1+max(value_sizes(:))),pi/2);
end
%end Add_sizes_Callback()

function Add_colors_Callback(obj, eventdat)
v=guidata(obj);
Select_colors_data(v);
v=guidata(obj);
value_colors=v.value_colors;
num_value_colors=numel(value_colors);
size_value_colors=size(value_colors);
list_value_colors(1:num_value_colors/2,2)=flipud(((num_value_colors/2)+1:num_value_colors)'); % here in case I decide to add display values in the future
if isfield(v,'list_regions')
    list_regions=v.list_regions; % nodes were previously selected
else
    temp=[(1:num_value_colors/2)' flipud((((num_value_colors/2)+1):num_value_colors)')]; % nodes were not previously selected- assigning names
    list_regions=(num2cell(temp));
end
value_colors=v.value_colors;
fprintf('Drawing circle with %d regions\n',numel(value_colors))
if isfield(v,'value_sizes')
    value_sizes=v.value_sizes;
    draw_circle(list_regions,v,value_sizes); %sizes were previously selected
else
    draw_circle(list_regions,v,(ones(size_value_colors))/4,value_colors)
end
if exist('list_regions','var')
    write_names(list_regions,(1+max(value_colors(:))),pi/2);
end
% draw_circle(list_regions,v,value_sizes);

% REPLACE_WITH_DASH_DASH- open a mesh or voxel image
function SelectFileToOpen(v)
%filename: mesh (GIFTI,VTK,PLY) or NIFTI voxel image to open
% thresh : (NIFTI only) isosurface threshold Inf for automatic, -Inf for dialog input
% reduce : (NIFTI only) path reduction ratio, e.g. 0.2 makes mesh 20% original size
% smooth : (NIFTI only) radius of smoothing, 0 = no smoothing
    
    [list_filename, list_pathname] = uigetfile( ...
                    {'*.xlsx;', 'excel files (*.xlsx)';...
                    '*.xls;', 'excel files (*.xls)'; ...
                    '*.*',       'All Files (*.*)'},...
                    'Select a text file');
    if isequal(list_filename,0), return; end;
    
    [~, list_regions]=xlsread([list_pathname list_filename]);
    v.list_regions=list_regions;
    guidata(v.hMainFigure,v)
   
% REPLACE_WITH_DASH_DASH- creates renderings
function draw_circle(list_regions,v,sizes,colors,colorscheme)
axis square
delete(allchild(v.hAxes));%
set(v.hMainFigure,'CurrentAxes',v.hAxes)
set(0, 'CurrentFigure', v.hMainFigure);  %# for figures
    n=(size(list_regions,1)*(size(list_regions,2)));
    if nargin<3;
        % set constants
        r = 1;  % sets the outer radius
        list_sizes(1:n,1)=r*1.1; % sets the inner radius as 0.9 of R
    else
        r = 1;
        list_sizes(1:n/2,1)=sizes(1:end,1);
        list_sizes(1:n/2,2)=flipud(sizes(1:end,2));% flip the second column for sequential drawing of segments
        list_sizes=list_sizes+r;
    end
    if nargin>=4
        list_colors(1:n/2,1)=colors(1:end,1);
        list_colors(1:n/2,2)=flipud(colors(1:end,2));
        list_colors=[list_colors(1:n/2,1);list_colors(1:n/2,2)]; % organized into one single column 
       
    else
        list_colors=rand(n,1);
        list_colors(n/2,1)=0.5;% set the mid value as on (to set the color as the mid-value
    end
    if nargin<5
        colorscheme=hot;
    end
    start_radian=pi/2; %sets the origin of the first segment (could also be 0)
    end_radian=start_radian+(2*pi)/n; %sets the end of the first segment (could also be pi/2)
    % end constants
    
    axis square        
    for segment=1:n % draw the circle
        % map colors
        color=find_color_in_colorscheme(list_colors(segment),list_colors,colorscheme);           
        draw_segment(start_radian,end_radian,list_sizes(segment),r,color,[])
        start_radian=end_radian;
        end_radian=start_radian+(2*pi)/n;
        pause(0.01)
        hold on        
    end
    R=max(list_sizes(:));
    axis([-2.3*R 2.3*R -2.3*R 2.3*R])
    axis square
    axis off

function draw_segment(start,term,R,r,color,height)
    
    seg = linspace( start, term, 100);
    %outer rim
    if isempty(height)
        height=0;
    end
    x_1 = (R+height)*cos(seg) ;
    y_1 = (R+height)*sin(seg) ;
    %inner rim
    x_2 = r*cos(seg) ;
    y_2 = r*sin(seg) ;
    % flip inner rim
    x_2=flipdim(x_2,2);
    y_2=flipdim(y_2,2);
    X=[x_1 x_2];
    Y=[y_1 y_2];
    pol=fill(X,Y,'r');    
    if ~isempty(color)
        set(pol,'FaceColor',color)
    end
    set(pol,'EdgeColor','k')
    set(pol,'FaceAlpha',0.4)

%end draw segment

function write_names(list_regions,radius,start_radian)
    regions=[list_regions(:,1);flipud(list_regions(:,2))]; % flip right hemisphere regions
    number_regions=size(regions,1);
    for i=1:number_regions        
        theta=  ( (start_radian + ( (i-1) *(2*pi/number_regions) ))...
            + (start_radian + ( (i *(2*pi/number_regions) )) ))/2 ;       
        x = radius * cos(theta);
        y = radius * sin(theta);        
        if ischar(regions{i})
            name=regions{i};
        else
            name=num2str(regions{i});
        end        
        text(x*(1.1), y*(1.1), name, 'HorizontalAlignment','center','FontSize',10)               
    end
    
% end write names
function Select_size_data(v)
[sizes_filename, sizes_pathname] = uigetfile( ...
                    {'*.xlsx;', 'excel files (*.xlsx)';...
                    '*.xls;', 'excel files (*.xls)'; ...
                    '*.*',       'All Files (*.*)'},...
                    'Select a text file');
    if isequal(sizes_filename,0), return; end;
    [value_sizes, ~]=xlsread([sizes_pathname sizes_filename]);
    v.value_sizes=value_sizes;       
    guidata(v.hMainFigure,v)
% end Select_size_data

function Select_colors_data(v)
[colors_filename, colors_pathname] = uigetfile( ...
                    {'*.xlsx;', 'excel files (*.xlsx)';...
                    '*.xls;', 'excel files (*.xls)'; ...
                    '*.*',       'All Files (*.*)'},...
                    'Select a text file');
    if isequal(colors_filename,0), return; end;
    [value_colors, ~]=xlsread([colors_pathname colors_filename]);
    v.value_colors=value_colors;     
    guidata(v.hMainFigure,v)

% REPLACE_WITH_DASH_DASH- Save screenshot as bitmap image
function saveBitmap(v,varargin)
% inputs: filename
%MATcro('saveBitmap',{'myPicture.png'});
if (length(varargin) < 1), return; end;
filename = char(varargin{1});
%saveas(v.hAxes, filename,'png'); %<- save as 150dpi
print (v.hMainFigure, '-r600', '-dpng', filename); %<- save as 600dpi , '-noui'
%end saveBitmap()

% find value associated with a color
function color=find_color_in_colorscheme(value,range,colorscheme)
    cm_length=size(colorscheme,1); % length of the colormap
    cmin=min(range); % min
    cmax=max(range); % max
    csteps=linspace(cmin,cmax,cm_length); % incremental steps from min to max within the length of the colormap
    C_index = ( abs(value-csteps) == min(abs(value-csteps)) ); % find the closest step to value
    color=colorscheme(C_index,:); % color associated with value     
%end find_color_in_colorscheme




    
##### SOURCE END #####
--></body></html>